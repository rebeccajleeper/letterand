<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hidden Word Puzzle Decoder | Solve Overlapping Letter Puzzles Instantly</title>
<meta name="description" content="Decode hidden word puzzles by overlapping two words and revealing the visible letters. The fastest overlapping word solver for MrBeast puzzles, viral challenges, and cipher clues.">
<meta name="keywords" content="hidden word puzzle decoder, MrBeast puzzle solver, overlapping word solver, letter overlap decoder, viral puzzle solver, word overlay tool, cipher puzzle decoder">
<meta property="og:title" content="Decode Hidden Word Puzzles in Seconds">
<meta property="og:description" content="Enter two words, decode the overlapping letters, and reveal the hidden answer. Built for viral word challenges and puzzle competitions.">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Hidden Word Puzzle Decoder">
<meta name="twitter:description" content="Enter two overlapping words and see which letters survive. Solve the puzzle in seconds.">
<meta name="google-site-verification" content="31UtkRzgtpMuY6LWWi98_j9bVhoDbEtEJIeKS59Cgd4">
<style>
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');

:root {
  --bg-deep: #0f0f0f;
  --bg-card: #1a1a1a;
  --bg-input: #242424;
  --border: #3a3a3a;
  --border-glow: #f0b840;
  --text: #f5f0e8;
  --text-muted: #c8c0b0;
  --text-dim: #8a8478;
  --accent-red: #ff4d6a;
  --accent-blue: #f0b840;
  --accent-green: #3ddba0;
  --accent-cyan: #ffd666;
  --radius: 14px;
  --shadow-card: 0 2px 20px rgba(0, 0, 0, 0.4);
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Plus Jakarta Sans', system-ui, -apple-system, sans-serif;
  background: var(--bg-deep);
  background-image:
    radial-gradient(ellipse 80% 60% at 50% -10%, rgba(240, 184, 64, 0.06), transparent),
    radial-gradient(ellipse 60% 40% at 80% 100%, rgba(255, 77, 106, 0.04), transparent);
  color: var(--text);
  line-height: 1.55;
  min-height: 100vh;
}

.app {
  max-width: 1020px;
  margin: 0 auto;
  padding: 42px 20px 80px;
}

.app-header { text-align: center; margin-bottom: 20px; }
.app-header h1 {
  font-size: clamp(2rem, 6vw, 2.8rem);
  font-weight: 800;
  letter-spacing: -1px;
  background: linear-gradient(135deg, var(--accent-red) 0%, var(--accent-blue) 50%, var(--accent-cyan) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 8px;
}
.subtitle { color: var(--text-muted); }
.trust-line {
  color: var(--accent-green);
  font-size: 0.88rem;
  font-weight: 600;
  margin-top: 6px;
  letter-spacing: 0.3px;
}

.card {
  background: linear-gradient(135deg, var(--bg-card), rgba(30, 30, 30, 0.6));
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow-card);
  padding: 22px;
  margin-bottom: 16px;
}

h2 {
  font-size: 1.02rem;
  font-weight: 700;
  text-transform: none;
  letter-spacing: 0.4px;
  color: var(--text-dim);
  margin-bottom: 10px;
}

.desc {
  color: var(--text-muted);
  font-size: 0.92rem;
  margin-bottom: 14px;
}

.intro-layout {
  display: grid;
  grid-template-columns: 1.3fr 1fr;
  gap: 14px;
}

.step-map {
  display: grid;
  gap: 8px;
}

.step-link {
  display: flex;
  align-items: center;
  gap: 10px;
  text-decoration: none;
  color: var(--text-muted);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px;
  background: rgba(0, 0, 0, 0.14);
}

.step-link:hover {
  border-color: var(--accent-cyan);
  color: var(--text);
}

.step-badge {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8rem;
  font-weight: 700;
  color: #fff;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
  flex-shrink: 0;
}

.section-title {
  display: flex;
  align-items: center;
  gap: 8px;
}

.section-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  flex-wrap: wrap;
}

.mode-pill {
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid var(--border);
  background: rgba(255, 255, 255, 0.03);
  font-size: 0.82rem;
  color: var(--text-muted);
  font-weight: 700;
}

.mode-pill.ready {
  border-color: rgba(61, 219, 160, 0.65);
  color: var(--accent-green);
}

.explainer-steps { display: grid; gap: 10px; }
.step {
  display: grid;
  grid-template-columns: 28px 1fr;
  gap: 10px;
}
.step-num {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 0.82rem;
  font-weight: 700;
  color: #fff;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
}
.step p { color: var(--text-muted); font-size: 0.92rem; }
.step strong { color: var(--text); }
.step-main {
  display: grid;
  gap: 8px;
}

.step-visual {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-wrap: wrap;
}

.step-visual canvas {
  width: 48px;
  height: 48px;
  border: 1px solid var(--border);
  border-radius: 6px;
  background: #fff;
}

.step-visual .op {
  color: var(--text-dim);
  font-size: 0.82rem;
  font-weight: 700;
}

.example-chip {
  margin-top: 10px;
  font-size: 0.88rem;
  color: var(--text-muted);
}

.example-visual {
  margin-top: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.example-visual canvas {
  width: 56px;
  height: 56px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: #fff;
}

.example-visual .op {
  color: var(--text-dim);
  font-size: 0.9rem;
  font-weight: 700;
}

.demo-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 12px;
  margin-top: 10px;
}

.demo-card {
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 12px;
  background: rgba(0, 0, 0, 0.14);
}

.demo-title {
  font-size: 0.86rem;
  color: var(--text);
  font-weight: 700;
  margin-bottom: 8px;
}

.demo-canvas-row {
  display: flex;
  gap: 6px;
  align-items: center;
  flex-wrap: wrap;
}

.demo-canvas-row canvas {
  width: 56px;
  height: 56px;
  border: 1px solid var(--border);
  border-radius: 6px;
  background: #fff;
}

.word-row {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
  margin-bottom: 12px;
}

.entry-guide {
  margin-top: -2px;
  margin-bottom: 12px;
  font-size: 0.86rem;
  color: var(--text-dim);
}

.word-row label {
  width: 82px;
  font-size: 0.8rem;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
  font-weight: 700;
}

.letter-slots { display: flex; gap: 8px; flex-wrap: wrap; }

.letter-slot {
  width: 56px;
  height: 56px;
  border-radius: 10px;
  border: 2px solid var(--border);
  background: var(--bg-input);
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
  text-align: center;
  font-family: 'Arial Black', 'Arial Bold', sans-serif;
  font-size: 1.75rem;
  text-transform: uppercase;
  outline: none;
  transition: border-color 0.2s, box-shadow 0.2s;
}

.slot-a { color: var(--accent-red); }
.slot-b { color: var(--accent-blue); }
.slot-a:focus { border-color: var(--accent-red); box-shadow: inset 0 2px 4px rgba(0,0,0,0.3), 0 0 0 3px rgba(255, 77, 106, 0.15); }
.slot-b:focus { border-color: var(--accent-blue); box-shadow: inset 0 2px 4px rgba(0,0,0,0.3), 0 0 0 3px rgba(240, 184, 64, 0.15); }

.letter-slot.locked {
  opacity: 0.45;
  cursor: not-allowed;
  background: rgba(255, 255, 255, 0.04);
  border-style: dashed;
}

.entry-actions {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 8px;
}

.primary-btn,
.secondary-btn {
  border-radius: 10px;
  padding: 10px 14px;
  cursor: pointer;
  font-weight: 700;
}

.primary-btn {
  border: 1px solid var(--border-glow);
  color: #fff;
  background: linear-gradient(135deg, rgba(255,77,106,0.22), rgba(240,184,64,0.22));
  font-size: 0.95rem;
  padding: 12px 20px;
  box-shadow: 0 0 12px rgba(240, 184, 64, 0.1);
  transition: border-color 0.2s, box-shadow 0.2s, transform 0.15s;
}
.primary-btn:hover { border-color: var(--accent-cyan); box-shadow: 0 0 18px rgba(240, 184, 64, 0.2); transform: translateY(-1px); }
.primary-btn:active { transform: translateY(0); }
.primary-btn:disabled {
  cursor: not-allowed;
  opacity: 0.45;
  border-color: var(--border);
  box-shadow: none;
  transform: none;
}

.secondary-btn {
  border: 1px solid var(--border);
  color: var(--text-muted);
  background: rgba(255, 255, 255, 0.02);
}
.secondary-btn:hover { color: var(--text); border-color: var(--border-glow); }

.control-label {
  font-size: 0.86rem;
  color: var(--text-muted);
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

select {
  background: var(--bg-input);
  border: 1px solid var(--border);
  color: var(--text);
  border-radius: 8px;
  padding: 6px 8px;
  font-size: 0.86rem;
}

.inline-status { font-size: 0.84rem; color: var(--text-dim); }
.error-text { min-height: 18px; color: #ff8899; font-size: 0.85rem; margin-top: 4px; }

.result-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 10px;
  margin-top: 14px;
}

.result-card {
  background: rgba(0, 0, 0, 0.15);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px;
}

.result-card.match { border-color: rgba(61, 219, 160, 0.8); }
.result-card.mismatch { border-color: rgba(255, 77, 106, 0.7); }

.result-head { font-size: 0.82rem; color: var(--text-muted); margin-bottom: 6px; }
.result-head .hl-a { color: var(--accent-red); font-weight: 700; }
.result-head .hl-b { color: var(--accent-blue); font-weight: 700; }

.card-canvases {
  display: flex;
  gap: 4px;
  justify-content: center;
  margin-bottom: 6px;
}

.card-canvases canvas {
  width: 62px;
  height: 62px;
  border-radius: 4px;
  border: 1px solid var(--border);
  background: #fff;
}

.result-meta { text-align: center; font-size: 0.9rem; }
.best-letter { color: var(--accent-green); font-size: 1rem; font-weight: 700; }
.score-text { color: var(--text-muted); font-size: 0.82rem; }
.score-note {
  margin-top: 4px;
  font-size: 0.8rem;
  color: var(--text-dim);
}

.summary {
  margin-top: 14px;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid var(--border);
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  font-size: 0.86rem;
  background: rgba(0, 0, 0, 0.16);
}

.summary-row { margin-bottom: 4px; }
.summary .label { color: var(--text-muted); }
.summary .val-a { color: var(--accent-red); font-weight: 700; letter-spacing: 1px; }
.summary .val-b { color: var(--accent-blue); font-weight: 700; letter-spacing: 1px; }
.summary .val-r { color: var(--accent-green); font-weight: 700; letter-spacing: 1px; }

.upload-row {
  display: flex;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
  margin-bottom: 10px;
}

.upload-row input[type="file"] { font-size: 0.86rem; color: var(--text-muted); }

.upload-controls {
  margin-bottom: 10px;
  color: var(--text-dim);
  font-size: 0.84rem;
}

.compare-section {
  margin-top: 8px;
  padding: 16px;
  background: rgba(0, 0, 0, 0.15);
  border-radius: 10px;
  border: 1px solid var(--border);
}

.compare-title { font-size: 0.86rem; color: var(--text-muted); margin-bottom: 8px; }
.compare-row { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
.row-label {
  font-size: 0.8rem;
  color: var(--text-dim);
  width: 118px;
  text-align: right;
  flex-shrink: 0;
}

#cropWrap { position: relative; overflow: visible; cursor: grab; min-height: 40px; }
#cropCanvas { border-radius: 4px; position: relative; left: 0; }
#resizeHandle {
  position: absolute;
  width: 14px;
  height: 14px;
  border-radius: 3px;
  background: var(--accent-cyan);
  border: 1px solid #fff;
  box-shadow: 0 0 0 1px rgba(0,0,0,0.4);
  cursor: nwse-resize;
  display: none;
}
#mergedRow { display: flex; gap: 2px; flex-wrap: wrap; }
#mergedRow canvas { width: 56px; height: 56px; border-radius: 4px; background: #fff; }

.compare-status { font-size: 0.85rem; color: var(--text-dim); margin-bottom: 8px; }

.unlock-box {
  margin-top: 8px;
  padding: 18px;
  border: 1px solid var(--border-glow);
  border-radius: 12px;
  background: linear-gradient(135deg, rgba(240, 184, 64, 0.06), rgba(255, 77, 106, 0.04));
  box-shadow: 0 0 20px rgba(240, 184, 64, 0.06);
}

.unlock-title {
  font-size: 0.95rem;
  font-weight: 700;
  color: var(--accent-cyan);
  margin-bottom: 6px;
}

.unlock-copy {
  font-size: 0.86rem;
  color: var(--text-muted);
  margin-bottom: 10px;
}

.paywall-form {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  align-items: center;
}

.paywall-email {
  min-width: 220px;
  background: var(--bg-input);
  border: 1px solid var(--border);
  color: var(--text);
  border-radius: 10px;
  padding: 9px 10px;
  font-size: 0.9rem;
}

.paywall-status {
  margin-top: 8px;
  font-size: 0.84rem;
  color: var(--text-dim);
  min-height: 18px;
}

.paywall-status.error { color: #ff9cab; }

.unlocked-bar {
  margin-top: 8px;
  display: none;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
  font-size: 0.86rem;
  color: var(--text-muted);
}

.admin-wrap {
  margin-top: 10px;
}

.admin-form {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-top: 8px;
}

.admin-input {
  min-width: 180px;
  background: var(--bg-input);
  border: 1px solid var(--border);
  color: var(--text);
  border-radius: 10px;
  padding: 9px 10px;
  font-size: 0.9rem;
}

.copy-status {
  font-size: 0.82rem;
  color: var(--text-dim);
}

.substep-title {
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 8px 0 8px;
  color: var(--text-muted);
  font-size: 0.9rem;
  font-weight: 700;
}

.faq-list {
  display: grid;
  gap: 8px;
}

.faq-item {
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px;
  background: rgba(0, 0, 0, 0.14);
}

.help-toggle-row {
  display: flex;
  justify-content: center;
  margin: 8px 0 14px;
}

.help-panel {
  display: none;
}

.help-panel.open {
  display: block;
}

.faq-q {
  font-weight: 700;
  color: var(--text);
  margin-bottom: 4px;
}

.faq-a {
  color: var(--text-muted);
  font-size: 0.9rem;
}

.coming-soon {
  margin-top: 24px;
  text-align: center;
  padding: 20px;
}

.coming-soon h3 {
  font-size: 0.9rem;
  font-weight: 700;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1.5px;
  margin-bottom: 12px;
}

.coming-soon-tools {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  max-width: 600px;
  margin: 0 auto;
}

.coming-soon-item {
  border: 1px dashed var(--border);
  border-radius: 10px;
  padding: 12px 10px;
  background: rgba(0, 0, 0, 0.1);
  color: var(--text-dim);
  font-size: 0.84rem;
  font-weight: 600;
}

@media (max-width: 640px) {
  .intro-layout {
    grid-template-columns: 1fr;
  }
  .app { padding: 30px 14px 60px; }
  .card { padding: 16px; }
  .word-row label { width: 100%; }
  .row-label { width: 84px; text-align: left; }
  .primary-btn { width: 100%; text-align: center; }
  .entry-actions { gap: 8px; }
  .letter-slots { gap: 6px; }
  .letter-slot { width: 48px; height: 48px; font-size: 1.5rem; }
  .coming-soon-tools { grid-template-columns: 1fr; }
}
</style>
</head>
<body>
<div class="app">
  <header class="app-header">
    <h1>Decode Hidden Word Puzzles in Seconds</h1>
    <p class="subtitle">Enter two overlapping words and see which letters survive. Solve the puzzle in seconds.</p>
    <p class="trust-line">Built for viral word challenges</p>
  </header>
  <div class="help-toggle-row">
    <button class="secondary-btn" id="helpToggleBtn" type="button">Help & FAQ</button>
  </div>
  <section class="card help-panel" id="helpPanel">
    <h2>FAQ</h2>
    <div class="faq-list">
      <div class="faq-item">
        <div class="faq-q">How does the hidden word puzzle decoder work?</div>
        <div class="faq-a">Enter two words letter by letter. The decoder overlaps each letter pair and calculates which visible letter emerges. A higher match percentage means the decoded letter is more confident. Perfect for solving overlapping word puzzles and viral challenges.</div>
      </div>
      <div class="faq-item">
        <div class="faq-q">Do font and sizing affect overlap results?</div>
        <div class="faq-a">Yes. Different fonts can shift the overlapping letter shapes. This decoder uses a consistent rendering baseline so your results are reliable across all puzzle types.</div>
      </div>
      <div class="faq-item">
        <div class="faq-q">Is this a subscription?</div>
        <div class="faq-a">No. Full mode is a one-time $4.99 purchase. No subscription, no recurring charges. Decode unlimited puzzles forever.</div>
      </div>
      <div class="faq-item">
        <div class="faq-q">How do I recover access on a new device?</div>
        <div class="faq-a">Use your purchase email to request an Email Sign-In Link. Your full mode access is restored instantly on any device or browser.</div>
      </div>
      <div class="faq-item">
        <div class="faq-q">Is this tool affiliated with MrBeast?</div>
        <div class="faq-a">No. This is an independent puzzle-solving tool. It works with any overlapping letter puzzle, including MrBeast challenges, cipher clues, and viral word games.</div>
      </div>
    </div>
  </section>

  <section class="card">
    <div class="intro-layout">
      <div>
        <h2>How It Works</h2>
        <p class="desc">Stack two words on top of each other and instantly see which letters appear in the overlap. Compare your decoded result against a clue image to confirm the hidden answer.</p>
        <div class="example-chip">Each letter pair gets a match score. The higher the percentage, the more confidently that letter is decoded.</div>
        <div class="example-chip">See it in action: overlapping O and B reveals O because O's shape fits entirely inside B.</div>
        <div class="example-visual" id="quickExampleVisual" aria-label="Quick overlap example"></div>
      </div>
      <div>
        <h2>Flow</h2>
        <div class="step-map">
          <a class="step-link" href="#buildSection"><span class="step-badge">1</span><span>Enter puzzle letters</span></a>
          <a class="step-link" href="#buildSection"><span class="step-badge">2</span><span>Decode the overlap</span></a>
          <a class="step-link" href="#compareSection"><span class="step-badge">3</span><span>Reveal the hidden word</span></a>
        </div>
      </div>
    </div>
  </section>

  <section class="card" id="buildSection">
    <div class="section-row">
      <h2 class="section-title"><span class="step-badge">1</span>Enter 2 Words</h2>
      <span class="mode-pill" id="modePill">Preview Mode: 1 generate, 1 letter per word</span>
    </div>
    <p class="desc">Start in preview mode. You can generate once here, then continue with full mode after unlock.</p>

    <div class="word-row">
      <label>Word A</label>
      <div class="letter-slots" id="slotsA"></div>
    </div>

    <div class="word-row">
      <label>Word B</label>
      <div class="letter-slots" id="slotsB"></div>
    </div>
    <div class="entry-guide">Slots start empty by design. Enter a letter in every slot above, then click Generate Combined Matches.</div>

    <div class="substep-title"><span class="step-badge">2</span><span>Generate Combined Matches</span></div>

    <div class="entry-actions">
      <button class="primary-btn" id="generateBtn">Generate Combined Matches</button>
      <button class="secondary-btn" id="copyWordABtn" type="button" disabled>Copy Word A</button>
      <button class="secondary-btn" id="copyWordBBtn" type="button" disabled>Copy Word B</button>
      <button class="secondary-btn" id="clearBtn" type="button">Clear</button>
      <label class="control-label" for="lengthSelect" id="lengthLabel" style="display:none">Letters per word:
        <select id="lengthSelect">
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="11">11</option>
          <option value="12">12</option>
          <option value="13">13</option>
          <option value="14">14</option>
          <option value="15">15</option>
        </select>
      </label>
      <span class="inline-status" id="validityHint"></span>
      <span class="copy-status" id="copyStatus"></span>
    </div>

    <div class="error-text" id="entryError"></div>

    <div class="result-grid" id="resultGrid"></div>
    <div class="summary" id="summary"></div>
    <div class="entry-actions" id="buildUnlockHint">
      <a href="#unlockSection" class="primary-btn" style="text-decoration:none">Unlock Full Mode</a>
    </div>
  </section>

  <section class="card" id="compareSection">
    <h2 class="section-title"><span class="step-badge">3</span>Compare With Clue Image</h2>
    <p class="desc">Upload one clue image showing the combined result. Compare and align it with your generated overlay strip.</p>
    <div class="compare-status" id="compareStatus">Generate at least once in Step 1 (Build), then compare here.</div>

    <div class="upload-row">
      <label class="control-label" for="cropFileInput">Clue Overlay Image:</label>
      <input type="file" id="cropFileInput" accept="image/*">
      <button class="secondary-btn" id="clearClueBtn" type="button" style="display:none;padding:6px 12px;font-size:0.82rem;">Clear Image</button>
    </div>
    <div class="upload-controls" id="clueEditor">
      <span>Manipulate clue image directly: drag image to align, drag corner handle to resize.</span>
    </div>

    <div class="compare-section">
      <div class="compare-title">Visual Alignment <span style="font-size:0.76rem;color:var(--text-dim)">(drag clue image horizontally to align)</span></div>
      <div class="compare-row">
        <span class="row-label">Clue image:</span>
        <div id="cropWrap">
          <canvas id="cropCanvas" width="1" height="1"></canvas>
          <div id="resizeHandle" aria-label="Resize clue image handle"></div>
        </div>
      </div>
      <div class="compare-row">
        <span class="row-label">Generated overlay:</span>
        <div id="mergedRow"></div>
      </div>
    </div>
  </section>

  <section class="card" id="unlockSection">
    <h2>Unlock Unlimited Decoding</h2>
    <div class="unlock-box" id="unlockBox">
      <div class="unlock-title">One-time $4.99 to decode unlimited puzzles</div>
      <div class="unlock-copy">No subscription, no hidden fees. Unlock full mode with up to 14 letters per word and unlimited generation attempts, for less than a coffee.</div>
      <div class="unlock-copy">Instant access after payment. Use Email Sign-In Link to restore access on a new device or browser.</div>
      <div class="paywall-form">
        <input type="text" id="paywallEmail" class="paywall-email" placeholder="you@example.com" autocomplete="username">
        <button class="primary-btn" id="paywallBuyBtn" type="button">Pay $4.99 & Unlock</button>
        <button class="secondary-btn" id="paywallMagicBtn" type="button">Email Sign-In Link</button>
      </div>
      <div class="paywall-status" id="paywallStatus"></div>
      <div class="unlocked-bar" id="wordUnlocked">
        <span>Signed in as <strong id="wordEmail"></strong></span>
        <button class="secondary-btn" id="wordLogoutBtn" type="button">Sign Out</button>
      </div>
    </div>
  </section>

  <footer class="coming-soon">
    <h3>Coming Soon</h3>
    <div class="coming-soon-tools">
      <div class="coming-soon-item">XOR Letter Decoder</div>
      <div class="coming-soon-item">Multi-Word Stacker</div>
      <div class="coming-soon-item">Visual Diff Matcher</div>
    </div>
  </footer>

</div>

<script>
var CELL = 200;
var ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
var RENDER_FONT_SIZE = 120; // kept as background engine setting
var STORAGE_KEY = 'letterand_access';

var isUnlocked = false;
var isAdmin = false;
var previewGenerations = parseInt(localStorage.getItem('previewGens_v2') || '0', 10);
var currentLength = 1;
var cropImage = null;
var clueDisplayHeight = 72;
var lastVisibleWord = '';
var lastState = null;

var slotsA = document.getElementById('slotsA');
var slotsB = document.getElementById('slotsB');
var modePill = document.getElementById('modePill');
var generateBtn = document.getElementById('generateBtn');
var copyWordABtn = document.getElementById('copyWordABtn');
var copyWordBBtn = document.getElementById('copyWordBBtn');
var clearBtn = document.getElementById('clearBtn');
var copyStatus = document.getElementById('copyStatus');
var lengthLabel = document.getElementById('lengthLabel');
var lengthSelect = document.getElementById('lengthSelect');
var unlockBox = document.getElementById('unlockBox');
var paywallEmail = document.getElementById('paywallEmail');
var paywallBuyBtn = document.getElementById('paywallBuyBtn');
var paywallMagicBtn = document.getElementById('paywallMagicBtn');
var paywallStatus = document.getElementById('paywallStatus');
var wordUnlocked = document.getElementById('wordUnlocked');
var wordEmail = document.getElementById('wordEmail');
var wordLogoutBtn = document.getElementById('wordLogoutBtn');
var cropCanvas = document.getElementById('cropCanvas');
var cropWrap = document.getElementById('cropWrap');
var resizeHandle = document.getElementById('resizeHandle');
var cropFileInput = document.getElementById('cropFileInput');
var clearClueBtn = document.getElementById('clearClueBtn');
var clueEditor = document.getElementById('clueEditor');
var resultGrid = document.getElementById('resultGrid');
var summaryDiv = document.getElementById('summary');
var mergedRow = document.getElementById('mergedRow');
var entryError = document.getElementById('entryError');
var validityHint = document.getElementById('validityHint');
var compareStatus = document.getElementById('compareStatus');
var quickExampleVisual = document.getElementById('quickExampleVisual');
var buildUnlockHint = document.getElementById('buildUnlockHint');
var helpToggleBtn = document.getElementById('helpToggleBtn');
var helpPanel = document.getElementById('helpPanel');

function clamp(value, min, max) {
  return Math.max(min, Math.min(max, value));
}

function getStored() {
  try {
    return JSON.parse(localStorage.getItem(STORAGE_KEY)) || null;
  } catch (_) {
    return null;
  }
}

function setStored(data) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function clearStored() {
  localStorage.removeItem(STORAGE_KEY);
}

function setPaywallStatus(msg, isError) {
  paywallStatus.textContent = msg || '';
  paywallStatus.className = 'paywall-status' + (isError ? ' error' : '');
}

async function startCheckout(email) {
  var res = await fetch('/api/create-checkout', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email: email }),
  });
  var data = await res.json();
  if (data.url) window.location.href = data.url;
  if (data.alreadyPurchased) {
    var err = new Error(data.error || 'Already purchased');
    err.code = 'ALREADY_PURCHASED';
    throw err;
  }
  if (!data.url) {
    throw new Error(data.error || 'Checkout failed');
  }
  return data;
}

async function verifyCheckout(sessionId) {
  var res = await fetch('/api/verify-payment', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ session_id: sessionId }),
  });
  return res.json();
}

async function requestMagicLink(email) {
  var res = await fetch('/api/request-login-link', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email: email }),
  });
  return res.json();
}

async function verifyMagicLink(email, token) {
  var res = await fetch('/api/verify-login-link', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email: email, token: token }),
  });
  return res.json();
}

var cropLeft = 0;
var cropTop = 0;
var cropAspect = 1;

function sanitizeLetter(value) {
  var m = (value || '').toUpperCase().match(/[A-Z]/);
  return m ? m[0] : '';
}

function getSlots(group) {
  return Array.prototype.slice.call(document.querySelectorAll('.letter-slot[data-group="' + group + '"]'));
}

function slotWord(group) {
  var slots = getSlots(group);
  var s = '';
  for (var i = 0; i < slots.length; i++) {
    if (slots[i].disabled) continue;
    s += sanitizeLetter(slots[i].value);
  }
  return s;
}

function buildSlot(group, idx, locked) {
  var input = document.createElement('input');
  input.type = 'text';
  input.maxLength = 1;
  input.autocomplete = 'off';
  input.spellcheck = false;
  input.placeholder = '';
  input.className = 'letter-slot ' + (group === 'a' ? 'slot-a' : 'slot-b') + (locked ? ' locked' : '');
  input.setAttribute('data-group', group);
  input.setAttribute('data-index', String(idx));
  if (locked) {
    input.disabled = true;
    input.tabIndex = -1;
  }

  input.addEventListener('input', function() {
    input.value = sanitizeLetter(input.value);

    if (input.value) {
      var idxNum = parseInt(input.getAttribute('data-index'), 10);
      var sameGroupSlots = getSlots(group);
      if (idxNum < sameGroupSlots.length - 1) sameGroupSlots[idxNum + 1].focus();
    }

    syncValidity();
  });

  input.addEventListener('keydown', function(e) {
    if (e.key === 'Backspace' && !input.value) {
      var idxNum = parseInt(input.getAttribute('data-index'), 10);
      var sameGroupSlots = getSlots(group);
      if (idxNum > 0) sameGroupSlots[idxNum - 1].focus();
    }
  });

  return input;
}

function renderSlots(length) {
  while (slotsA.firstChild) slotsA.removeChild(slotsA.firstChild);
  while (slotsB.firstChild) slotsB.removeChild(slotsB.firstChild);

  for (var i = 0; i < 14; i++) {
    var locked = i >= length;
    slotsA.appendChild(buildSlot('a', i, locked));
    slotsB.appendChild(buildSlot('b', i, locked));
  }

  clearResults();
  syncValidity();
  var firstA = getSlots('a')[0];
  if (firstA) firstA.focus();
}

function updateModeUI() {
  if (isUnlocked) {
    modePill.textContent = 'Full Mode: 14 letters, unlimited generation';
    modePill.classList.add('ready');
    wordUnlocked.style.display = 'flex';
    wordEmail.textContent = isAdmin ? 'admin' : ((getStored() && getStored().email) || 'member');
    paywallBuyBtn.style.display = 'none';
    paywallMagicBtn.style.display = 'none';
    paywallEmail.style.display = 'none';
    unlockBox.style.borderStyle = 'solid';
    buildUnlockHint.style.display = 'none';
    currentLength = 14;
  } else {
    modePill.textContent = 'Preview Mode: 1 generate, 1 letter per word';
    modePill.classList.remove('ready');
    wordUnlocked.style.display = 'none';
    paywallBuyBtn.style.display = 'inline-block';
    paywallMagicBtn.style.display = 'inline-block';
    paywallEmail.style.display = 'inline-block';
    currentLength = 1;
    unlockBox.style.borderStyle = 'dashed';
    buildUnlockHint.style.display = 'flex';
  }
  renderSlots(currentLength);
}

function renderLetter(ch, fontSize) {
  var c = document.createElement('canvas');
  c.width = CELL;
  c.height = CELL;
  var ctx = c.getContext('2d');
  ctx.fillStyle = '#fff';
  ctx.fillRect(0, 0, CELL, CELL);
  ctx.fillStyle = '#000';
  var scaledFont = Math.round(fontSize * (CELL / 80));
  ctx.font = scaledFont + 'px "Arial Black", "Arial Bold", sans-serif';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(ch.toUpperCase(), CELL / 2, CELL / 2 + Math.round(CELL * 0.02));
  return ctx.getImageData(0, 0, CELL, CELL);
}

function toBinary(imageData) {
  var d = imageData.data;
  var mask = new Uint8Array(CELL * CELL);
  for (var i = 0; i < mask.length; i++) {
    var brightness = (d[i * 4] + d[i * 4 + 1] + d[i * 4 + 2]) / 3;
    mask[i] = brightness < 128 ? 1 : 0;
  }
  return mask;
}

function andMasks(a, b) {
  var result = new Uint8Array(a.length);
  for (var i = 0; i < a.length; i++) result[i] = a[i] & b[i];
  return result;
}

function matchScore(candidate, target) {
  var inter = 0;
  var cSum = 0;
  var tSum = 0;
  for (var i = 0; i < candidate.length; i++) {
    if (candidate[i]) cSum++;
    if (target[i]) tSum++;
    if (candidate[i] && target[i]) inter++;
  }
  if (cSum === 0 && tSum === 0) return 1;
  if (cSum === 0 || tSum === 0) return 0;
  var union = cSum + tSum - inter;
  var iouVal = inter / union;
  var prec = inter / cSum;
  var rec = inter / tSum;
  var f1Val = (prec + rec) > 0 ? 2 * prec * rec / (prec + rec) : 0;
  return 0.4 * iouVal + 0.6 * f1Val;
}

function drawMask(canvas, mask, r, g, b) {
  var ctx = canvas.getContext('2d');
  var img = ctx.createImageData(CELL, CELL);
  for (var i = 0; i < mask.length; i++) {
    img.data[i * 4] = mask[i] ? r : 255;
    img.data[i * 4 + 1] = mask[i] ? g : 255;
    img.data[i * 4 + 2] = mask[i] ? b : 255;
    img.data[i * 4 + 3] = 255;
  }
  ctx.putImageData(img, 0, 0);
}

function buildLetterMasks(fontSize) {
  var masks = {};
  for (var j = 0; j < ALPHABET.length; j++) {
    var ch = ALPHABET[j];
    masks[ch] = toBinary(renderLetter(ch, fontSize));
  }
  return masks;
}

function findBestMatch(mask, letterMasks) {
  var best = { ch: 'A', score: -1 };
  for (var j = 0; j < ALPHABET.length; j++) {
    var ch = ALPHABET[j];
    var score = matchScore(letterMasks[ch], mask);
    if (score > best.score) best = { ch: ch, score: score };
  }
  return best;
}

function clearElement(el) {
  while (el.firstChild) el.removeChild(el.firstChild);
}

function clearResults() {
  clearElement(resultGrid);
  clearElement(summaryDiv);
  clearElement(mergedRow);
  compareStatus.textContent = 'Generate at least once in Step 1 (Build), then compare here.';
  copyWordABtn.disabled = true;
  copyWordBBtn.disabled = true;
  lastVisibleWord = '';
  copyStatus.textContent = '';
  lastState = null;
}

function drawCrop() {
  if (!cropImage) {
    cropCanvas.width = 1;
    cropCanvas.height = 1;
    resizeHandle.style.display = 'none';
    return;
  }
  var h = clueDisplayHeight;
  var w = Math.max(1, Math.round(cropImage.width * (h / cropImage.height)));
  cropAspect = w / h;
  cropCanvas.width = w;
  cropCanvas.height = h;
  cropCanvas.style.width = w + 'px';
  cropCanvas.style.height = h + 'px';
  cropCanvas.style.left = cropLeft + 'px';
  cropCanvas.style.top = cropTop + 'px';
  var ctx = cropCanvas.getContext('2d');
  ctx.clearRect(0, 0, w, h);
  ctx.drawImage(cropImage, 0, 0, w, h);

  resizeHandle.style.display = 'block';
  positionResizeHandle();
}

function positionResizeHandle() {
  if (!cropImage) return;
  var w = parseInt(cropCanvas.style.width || '0', 10);
  var h = parseInt(cropCanvas.style.height || '0', 10);
  resizeHandle.style.left = (cropLeft + w - 7) + 'px';
  resizeHandle.style.top = (cropTop + h - 7) + 'px';
}

function renderQuickExample() {
  clearElement(quickExampleVisual);
  var masks = buildLetterMasks(RENDER_FONT_SIZE);
  var maskA = masks.O;
  var maskB = masks.B;
  var maskAnd = andMasks(maskA, maskB);
  var best = findBestMatch(maskAnd, masks);

  function addCanvas(mask, r, g, b) {
    var cv = document.createElement('canvas');
    cv.width = CELL;
    cv.height = CELL;
    drawMask(cv, mask, r, g, b);
    quickExampleVisual.appendChild(cv);
  }

  function addOp(text) {
    var op = document.createElement('span');
    op.className = 'op';
    op.textContent = text;
    quickExampleVisual.appendChild(op);
  }

  addCanvas(maskA, 233, 69, 96);
  addOp('+');
  addCanvas(maskB, 67, 97, 238);
  addOp('=');
  addCanvas(maskAnd, 34, 34, 34);
  addOp('looks like ' + best.ch);
}


function addSummaryLine(label, value, cls) {
  var row = document.createElement('div');
  row.className = 'summary-row';

  var left = document.createElement('span');
  left.className = 'label';
  left.textContent = label;

  var right = document.createElement('span');
  right.className = cls;
  right.textContent = value;

  row.appendChild(left);
  row.appendChild(right);
  summaryDiv.appendChild(row);
}

function setError(msg) {
  entryError.textContent = msg || '';
}

function validateSlots() {
  var wordA = slotWord('a');
  var wordB = slotWord('b');

  if (!isUnlocked && previewGenerations >= 1) {
    return { ok: false, message: 'Preview generate used. Unlock full mode for more generations.' };
  }

  if (isUnlocked) {
    if (wordA.length === 0 || wordB.length === 0) {
      return { ok: false, message: 'Enter at least 1 letter for each word.' };
    }
    if (wordA.length !== wordB.length) {
      return { ok: false, message: 'Both words must have the same number of letters.' };
    }
    return { ok: true, message: 'Ready to generate (' + wordA.length + ' letters).' };
  }

  if (wordA.length !== currentLength || wordB.length !== currentLength) {
    return { ok: false, message: 'Enter ' + currentLength + ' letter' + (currentLength === 1 ? '' : 's') + ' for each word.' };
  }

  return { ok: true, message: 'Ready to generate.' };
}

function syncValidity() {
  var v = validateSlots();
  generateBtn.disabled = !v.ok;
  validityHint.textContent = v.message;
  validityHint.style.color = v.ok ? 'var(--accent-green)' : 'var(--text-dim)';
}

function generate() {
  var validation = validateSlots();
  if (!validation.ok) {
    setError(validation.message);
    return;
  }

  var wordA = slotWord('a');
  var wordB = slotWord('b');
  var genLength = isUnlocked ? wordA.length : currentLength;

  setError('');
  clearElement(resultGrid);
  clearElement(summaryDiv);
  clearElement(mergedRow);

  var letterMasks = buildLetterMasks(RENDER_FONT_SIZE);
  var visibleWord = [];
  var andMaskList = [];

  for (var i = 0; i < genLength; i++) {
    var chA = wordA[i];
    var chB = wordB[i];
    var maskA = letterMasks[chA];
    var maskB = letterMasks[chB];
    var maskAND = andMasks(maskA, maskB);
    andMaskList.push(maskAND);

    var best = findBestMatch(maskAND, letterMasks);
    visibleWord.push(best.ch);

    var card = document.createElement('div');
    card.className = 'result-card ' + (best.score > 0.7 ? 'match' : 'mismatch');

    var head = document.createElement('div');
    head.className = 'result-head';
    head.innerHTML = 'Letter slot ' + (i + 1) + ' (left to right): <span class="hl-a">' + chA + '</span> + <span class="hl-b">' + chB + '</span>';
    card.appendChild(head);

    var cRow = document.createElement('div');
    cRow.className = 'card-canvases';

    var cvA = document.createElement('canvas');
    cvA.width = CELL;
    cvA.height = CELL;
    drawMask(cvA, maskA, 233, 69, 96);
    cRow.appendChild(cvA);

    var cvB = document.createElement('canvas');
    cvB.width = CELL;
    cvB.height = CELL;
    drawMask(cvB, maskB, 67, 97, 238);
    cRow.appendChild(cvB);

    var cvAnd = document.createElement('canvas');
    cvAnd.width = CELL;
    cvAnd.height = CELL;
    drawMask(cvAnd, maskAND, 34, 34, 34);
    cRow.appendChild(cvAnd);

    card.appendChild(cRow);

    var meta = document.createElement('div');
    meta.className = 'result-meta';
    var overlapPct = (best.score * 100).toFixed(1);
    meta.innerHTML = '= <span class="best-letter">' + best.ch + '</span> <span class="score-text">Overlap match: ' + overlapPct + '%</span>';
    card.appendChild(meta);

    resultGrid.appendChild(card);
  }

  for (var m = 0; m < andMaskList.length; m++) {
    var mini = document.createElement('canvas');
    mini.width = CELL;
    mini.height = CELL;
    drawMask(mini, andMaskList[m], 34, 34, 34);
    mergedRow.appendChild(mini);
  }

  addSummaryLine('Word A:  ', wordA, 'val-a');
  addSummaryLine('Word B:  ', wordB, 'val-b');
  lastVisibleWord = visibleWord.join('');
  copyWordABtn.disabled = !wordA;
  copyWordBBtn.disabled = !wordB;

  compareStatus.textContent = 'Generated overlay ready. Upload a clue image and align it to compare.';

  if (!isUnlocked) {
    previewGenerations += 1;
    localStorage.setItem('previewGens_v2', previewGenerations);
    syncValidity();
  }

  lastState = {
    wordA: wordA,
    wordB: wordB,
    length: currentLength
  };

  syncValidity();
}

generateBtn.addEventListener('click', generate);

copyWordABtn.addEventListener('click', async function() {
  var wordA = slotWord('a');
  if (!wordA) return;
  try {
    await navigator.clipboard.writeText(wordA);
    copyStatus.textContent = 'Copied Word A: ' + wordA;
  } catch (_) {
    copyStatus.textContent = 'Copy Word A failed. Please copy manually.';
  }
});

copyWordBBtn.addEventListener('click', async function() {
  var wordB = slotWord('b');
  if (!wordB) return;
  try {
    await navigator.clipboard.writeText(wordB);
    copyStatus.textContent = 'Copied Word B: ' + wordB;
  } catch (_) {
    copyStatus.textContent = 'Copy Word B failed. Please copy manually.';
  }
});

clearBtn.addEventListener('click', function() {
  renderSlots(currentLength);
  setError('');
  syncValidity();
});

paywallBuyBtn.addEventListener('click', async function() {
  var email = (paywallEmail.value || '').trim();
  if (!email || email.indexOf('@') === -1) {
    setPaywallStatus('Enter a valid email to unlock for $4.99.', true);
    return;
  }
  paywallBuyBtn.disabled = true;
  paywallBuyBtn.textContent = 'Redirecting...';
  setPaywallStatus('', false);
  try {
    await startCheckout(email);
  } catch (err) {
    if (err && err.code === 'ALREADY_PURCHASED') {
      setPaywallStatus('This email already has access. Use Email Sign-In Link.', false);
    } else {
      setPaywallStatus('Could not start checkout. Try again.', true);
    }
    paywallBuyBtn.disabled = false;
    paywallBuyBtn.textContent = 'Pay $4.99 & Unlock';
  }
});

paywallMagicBtn.addEventListener('click', async function() {
  var emailOrAdmin = (paywallEmail.value || '').trim();
  if (!emailOrAdmin) {
    setPaywallStatus('Enter your purchase email.', true);
    return;
  }

  paywallMagicBtn.disabled = true;
  paywallMagicBtn.textContent = 'Sending...';
  setPaywallStatus('', false);
  try {
    var data = await requestMagicLink(emailOrAdmin);
    if (data.sent) {
      setPaywallStatus('Sign-in link sent. Check your email.', false);
    } else {
      setPaywallStatus(data.error || 'Could not send sign-in link.', true);
    }
  } catch (_) {
    setPaywallStatus('Could not send sign-in link right now.', true);
  }
  paywallMagicBtn.disabled = false;
  paywallMagicBtn.textContent = 'Email Sign-In Link';
});

wordLogoutBtn.addEventListener('click', function() {
  isUnlocked = false;
  isAdmin = false;
  previewGenerations = 0;
  localStorage.removeItem('previewGens_v2');
  clearStored();
  updateModeUI();
  syncValidity();
  setPaywallStatus('Signed out.', false);
});

cropFileInput.addEventListener('change', function(e) {
  var file = e.target.files && e.target.files[0];
  if (!file) return;
  var reader = new FileReader();
  reader.onload = function(ev) {
    var img = new Image();
    img.onload = function() {
      cropImage = img;
      clueDisplayHeight = 72;
      cropLeft = 0;
      cropTop = 0;
      drawCrop();
      clearClueBtn.style.display = '';
    };
    img.src = ev.target.result;
  };
  reader.readAsDataURL(file);
});

clearClueBtn.addEventListener('click', function() {
  cropImage = null;
  cropLeft = 0;
  cropTop = 0;
  clueDisplayHeight = 72;
  cropFileInput.value = '';
  drawCrop();
  clearClueBtn.style.display = 'none';
});

helpToggleBtn.addEventListener('click', function() {
  var isOpen = helpPanel.classList.toggle('open');
  helpToggleBtn.textContent = isOpen ? 'Hide Help & FAQ' : 'Help & FAQ';
});

(function setupCropDrag() {
  var dragging = false;
  var resizing = false;
  var startX = 0;
  var startY = 0;
  var startLeft = 0;
  var startTop = 0;
  var startHeight = 0;

  cropWrap.addEventListener('mousedown', function(e) {
    if (!cropImage) return;
    if (e.target === resizeHandle) return;
    dragging = true;
    startX = e.clientX;
    startY = e.clientY;
    startLeft = cropLeft;
    startTop = cropTop;
    cropWrap.style.cursor = 'grabbing';
    e.preventDefault();
  });

  resizeHandle.addEventListener('mousedown', function(e) {
    if (!cropImage) return;
    resizing = true;
    startY = e.clientY;
    startHeight = clueDisplayHeight;
    e.preventDefault();
    e.stopPropagation();
  });

  document.addEventListener('mousemove', function(e) {
    if (dragging) {
      cropLeft = startLeft + (e.clientX - startX);
      cropTop = startTop + (e.clientY - startY);
      cropCanvas.style.left = cropLeft + 'px';
      cropCanvas.style.top = cropTop + 'px';
      positionResizeHandle();
      return;
    }
    if (resizing) {
      clueDisplayHeight = clamp(startHeight + (e.clientY - startY), 36, 260);
      var w = Math.max(1, Math.round(clueDisplayHeight * cropAspect));
      cropCanvas.style.width = w + 'px';
      cropCanvas.style.height = clueDisplayHeight + 'px';
      positionResizeHandle();
    }
  });

  document.addEventListener('mouseup', function() {
    dragging = false;
    resizing = false;
    cropWrap.style.cursor = 'grab';
  });
})();

async function initAccessState() {
  var params = new URLSearchParams(window.location.search);
  var sessionId = params.get('session_id');
  var magicToken = params.get('magic_token');
  var magicEmail = params.get('email');

  if (magicToken && magicEmail) {
    setPaywallStatus('Verifying sign-in link...', false);
    try {
      var linkResult = await verifyMagicLink(magicEmail, magicToken);
      if (linkResult.access) {
        isUnlocked = true;
        localStorage.removeItem('previewGens_v2');
        previewGenerations = 0;
        isAdmin = !!linkResult.admin;
        setStored({ access: true, email: linkResult.email || magicEmail, admin: !!linkResult.admin });
        updateModeUI();
        syncValidity();
        setPaywallStatus('Sign-in complete. Full mode unlocked.', false);
        window.history.replaceState({}, '', window.location.pathname);
        return;
      }
      setPaywallStatus('Sign-in link is invalid or expired.', true);
      window.history.replaceState({}, '', window.location.pathname);
      return;
    } catch (_) {
      setPaywallStatus('Could not verify sign-in link right now.', true);
      return;
    }
  }

  if (sessionId) {
    setPaywallStatus('Verifying payment...', false);
    try {
      var result = await verifyCheckout(sessionId);
      if (result.access) {
        isUnlocked = true;
        localStorage.removeItem('previewGens_v2');
        previewGenerations = 0;
        isAdmin = false;
        setStored({ access: true, email: result.email || (paywallEmail.value || '').trim(), admin: false });
        updateModeUI();
        syncValidity();
        setPaywallStatus('Payment verified. Full mode unlocked.', false);
        window.history.replaceState({}, '', window.location.pathname);
      } else {
        setPaywallStatus('Payment not confirmed yet.', true);
      }
    } catch (_) {
      setPaywallStatus('Could not verify payment right now.', true);
    }
  } else {
    var stored = getStored();
    if (stored && stored.access) {
      isUnlocked = true;
      localStorage.removeItem('previewGens_v2');
      previewGenerations = 0;
      isAdmin = !!stored.admin;
      if (stored.email && stored.email !== 'admin') paywallEmail.value = stored.email;
      updateModeUI();
      syncValidity();
      setPaywallStatus('Access restored on this device.', false);
    }
  }
}

(async function boot() {
  await initAccessState();
  updateModeUI();
  syncValidity();
  renderQuickExample();
})();
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "How does the hidden word puzzle decoder work?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Enter two words letter by letter. The decoder overlaps each letter pair and calculates which visible letter emerges. A higher match percentage means the decoded letter is more confident. Perfect for solving overlapping word puzzles and viral challenges."
      }
    },
    {
      "@type": "Question",
      "name": "Is this a subscription?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "No. Full mode is a one-time $4.99 purchase. No subscription, no recurring charges. Decode unlimited puzzles forever."
      }
    },
    {
      "@type": "Question",
      "name": "Is this tool affiliated with MrBeast?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "No. This is an independent puzzle-solving tool. It works with any overlapping letter puzzle, including MrBeast challenges, cipher clues, and viral word games."
      }
    }
  ]
}
</script>
</body>
</html>
